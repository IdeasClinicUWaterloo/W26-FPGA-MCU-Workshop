library IEEE;
use IEEE.STD_LOGIC_1164.ALL;
use IEEE.NUMERIC_STD.ALL;

entity game_logic is
	generic (
		H_ACTIVE: natural := 1280;
		V_ACTIVE: natural := 720
	);
	port (
		clk: in STD_LOGIC;
		reset: in STD_LOGIC;
		frame_start: in STD_LOGIC;
		p1_up, p1_dn: in STD_LOGIC;
		p2_up, p2_dn: in STD_LOGIC;
		p1_y: out signed(10 downto 0);
		p2_y: out signed(10 downto 0);
		ball_x: out signed(10 downto 0);
		ball_y: out signed(10 downto 0);
		score_l: out unsigned(3 downto 0);
		score_r: out unsigned(3 downto 0)
	);
end game_logic;


architecture procedural of game_logic is
	constant PADDLE_H: natural := 100;
	constant PADDLE_W: natural := 12;
	constant BALL_S: natural := 10;
	constant P1_X: integer := 40;
	constant P2_X: integer := H_ACTIVE - 40 - PADDLE_W;
	
	type GAME_STATE is (ST_PLAY, ST_SERVE);
	
	signal state: GAME_STATE := ST_SERVE;
	
	signal serve_countdown: natural;
	
	function clamp (
		x: integer;
		min: integer;
		max: integer
	) return integer is
		if x >= max then
			return max;
		elsif x <= min then
			return min;
		else
			return x;
		end if;
	end function;
	
end procedural;